<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scenario - Cyber Safer</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .scenario-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .detail-card {
      background: #161b22;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
    }

    .detail-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .detail-label {
      font-size: 0.85rem;
      color: #8b949e;
      margin-bottom: 0.3rem;
    }

    .detail-value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--fg);
    }

    .objectives-list {
      background: #161b22;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .objectives-list h3 {
      margin-top: 0;
      color: var(--accent);
    }

    .objectives-list ul {
      margin: 0;
      padding-left: 1.5rem;
    }

    .objectives-list li {
      margin: 0.75rem 0;
      line-height: 1.5;
    }

    .success-criteria {
      background: linear-gradient(135deg, rgba(63, 185, 80, 0.1), rgba(88, 166, 255, 0.1));
      border: 1px solid var(--success);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .success-criteria h3 {
      margin-top: 0;
      color: var(--success);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .criteria-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .criteria-item {
      background: rgba(0, 0, 0, 0.3);
      padding: 0.75rem;
      border-radius: 4px;
      border-left: 3px solid var(--success);
      font-size: 0.95rem;
    }

    .tips-box {
      background: rgba(88, 166, 255, 0.1);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 2rem 0;
    }

    .tips-box h3 {
      margin-top: 0;
      color: var(--accent);
    }

    .tips-box ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }

    .tips-box li {
      margin: 0.5rem 0;
    }

    .ready-section {
      text-align: center;
      margin: 2rem 0;
      padding: 2rem;
      background: #161b22;
      border-radius: 8px;
    }

    .ready-section p {
      font-size: 1.1rem;
      color: #8b949e;
      margin-bottom: 1.5rem;
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s ease-out;
    }

    .modal.show {
      display: flex;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: #161b22;
      border: 2px solid var(--danger);
      border-radius: 12px;
      padding: 2rem;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-content h3 {
      margin-top: 0;
      color: var(--danger);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.3rem;
    }

    .modal-content p {
      color: var(--fg);
      line-height: 1.6;
    }

    .modal-buttons {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }

    .modal-buttons button {
      flex: 1;
      padding: 0.75rem;
    }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo">üõ°Ô∏è Cyber Safer</a>
    <span class="mode-indicator" id="categoryName"></span>
  </header>

  <main>
    <div class="container" style="max-width: 900px;">
      <h1 id="scenarioTitle">Loading...</h1>
      
      <div class="scenario-details" id="scenarioDetails">
        <!-- Details will be populated -->
      </div>

      <div class="intro-box" id="introText">
        <!-- Introduction will be loaded here -->
      </div>

      <div class="success-criteria">
        <h3>üéØ Success Criteria</h3>
        <p>To pass this scenario, you should demonstrate these key behaviors:</p>
        <div class="criteria-grid" id="criteriaList">
          <!-- Will be populated dynamically -->
        </div>
      </div>

      <div class="objectives-list">
        <h3>üìö What You'll Learn</h3>
        <ul id="objectivesList">
          <!-- Will be populated dynamically -->
        </ul>
      </div>

      <div class="tips-box">
        <h3>üí° Tips for Success</h3>
        <ul>
          <li><strong>Read carefully:</strong> Pay attention to details in the messages you receive</li>
          <li><strong>Think critically:</strong> Ask yourself "What seems suspicious here?"</li>
          <li><strong>Respond naturally:</strong> Say what you would actually say in real life</li>
          <li><strong>Take your time:</strong> There's no time limit - think through your responses</li>
          <li><strong>Look for red flags:</strong> Urgency, requests for money/info, too-good-to-be-true offers</li>
        </ul>
      </div>

      <div class="ready-section">
        <p><strong>Ready to test your cybersecurity skills?</strong></p>
        <p>Remember: This is a safe training environment. Make choices, learn from them, and improve!</p>
        <div class="text-center">
          <a href="#" id="beginButton" class="button big-button">Begin Scenario ‚Üí</a>
          <a href="javascript:history.back()" class="button secondary">‚Üê Back to Scenarios</a>
        </div>
      </div>
    </div>
  </main>

  <!-- Error Modal -->
  <div class="modal" id="errorModal">
    <div class="modal-content">
      <h3>‚ö†Ô∏è Unable to Start</h3>
      <p id="errorMessage">Something went wrong. Please try again.</p>
      <div class="modal-buttons">
        <button id="closeError" class="secondary">Close</button>
        <button id="retryStart">Retry</button>
      </div>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    let scenarioId = null;

    const difficultyColors = {
      'beginner': 'var(--success)',
      'medium': 'var(--warning)',
      'hard': 'var(--danger)'
    };

    const difficultyIcons = {
      'beginner': 'üå±',
      'medium': '‚ö°',
      'hard': 'üî•'
    };

    function showErrorModal(message) {
      document.getElementById('errorMessage').textContent = message;
      document.getElementById('errorModal').classList.add('show');
    }

    function hideErrorModal() {
      document.getElementById('errorModal').classList.remove('show');
    }

    async function startScenario() {
      const btn = document.getElementById('beginButton');
      btn.textContent = 'Starting...';
      btn.style.pointerEvents = 'none';
      
      try {
        await API.startScenario(scenarioId);
        window.location.href = `chat.html?id=${scenarioId}`;
      } catch (error) {
        console.error('Start error:', error);
        btn.textContent = 'Begin Scenario ‚Üí';
        btn.style.pointerEvents = 'auto';
        
        showErrorModal('Failed to start scenario. Please check your connection and try again.');
      }
    }

    async function loadScenario() {
      const params = new URLSearchParams(window.location.search);
      scenarioId = params.get('id');
      
      if (!scenarioId) {
        window.location.href = 'categories.html';
        return;
      }

      try {
        const scenario = await API.getScenario(scenarioId);
        
        document.getElementById('scenarioTitle').textContent = scenario.title;
        document.getElementById('introText').textContent = scenario.introduction;
        document.getElementById('categoryName').textContent = `Training: ${scenario.category}`;
        document.title = `${scenario.title} - Cyber Safer`;
        
        // Populate scenario details
        const detailsContainer = document.getElementById('scenarioDetails');
        
        // Difficulty
        const difficultyCard = createDetailCard(
          difficultyIcons[scenario.difficulty] || '‚ö†Ô∏è',
          'Difficulty',
          scenario.difficulty.charAt(0).toUpperCase() + scenario.difficulty.slice(1)
        );
        difficultyCard.querySelector('.detail-value').style.color = difficultyColors[scenario.difficulty];
        detailsContainer.appendChild(difficultyCard);
        
        // Category
        const categoryCard = createDetailCard(
          'üìÅ',
          'Category',
          scenario.category.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())
        );
        detailsContainer.appendChild(categoryCard);
        
        // Red flags count
        const flagsCard = createDetailCard(
          'üö©',
          'Red Flags to Find',
          (scenario.success_criteria || []).length.toString()
        );
        detailsContainer.appendChild(flagsCard);
        
        // Populate success criteria
        const criteriaList = document.getElementById('criteriaList');
        (scenario.success_criteria || []).forEach(criterion => {
          const div = document.createElement('div');
          div.className = 'criteria-item';
          div.textContent = '‚úì ' + criterion.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
          criteriaList.appendChild(div);
        });
        
        // Populate learning objectives
        const objectivesList = document.getElementById('objectivesList');
        (scenario.learning_objectives || []).forEach(objective => {
          const li = document.createElement('li');
          li.textContent = objective;
          objectivesList.appendChild(li);
        });
        
        // Set up begin button
        document.getElementById('beginButton').onclick = (e) => {
          e.preventDefault();
          startScenario();
        };

        // Modal handlers
        document.getElementById('closeError').onclick = hideErrorModal;
        document.getElementById('retryStart').onclick = () => {
          hideErrorModal();
          startScenario();
        };

      } catch (error) {
        console.error('Failed to load scenario:', error);
        document.getElementById('introText').innerHTML = 
          '<p style="color: var(--danger)">‚ö†Ô∏è Failed to load scenario details.</p>';
        showErrorModal('Could not load scenario. Please check your connection.');
      }
    }

    function createDetailCard(icon, label, value) {
      const card = document.createElement('div');
      card.className = 'detail-card';
      card.innerHTML = `
        <div class="detail-icon">${icon}</div>
        <div class="detail-label">${label}</div>
        <div class="detail-value">${value}</div>
      `;
      return card;
    }

    loadScenario();
  </script>
</body>
</html>
